<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìœ íŠœë¸Œ ì œì‘ê¸° í™ˆ ëŒ€ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="container">
    <header class="header dashboard-header">
        <div class="brand">
            <h1>ìœ íŠœë¸Œ ì œì‘ê¸°</h1>
            <p class="subtitle">AI ì‡¼ì¸  ì œì‘ê¸° Â· ë²ˆì—­ê¸° Â· ë‹¤ìš´ë¡œë“œ ë„êµ¬</p>
        </div>
        <div class="dashboard-actions">
            <a class="btn-outline" href="/ytdl">ìœ íŠœë¸Œ ë‹¤ìš´ë¡œë“œ</a>
            <a class="btn-outline" href="/shorts">AI ì‡¼ì¸  ì œì‘ê¸°</a>
            <a class="btn-primary" href="/translator">ìƒˆ í”„ë¡œì íŠ¸ +</a>
        </div>
    </header>

    <section class="panel dashboard-search">
        <label for="dashboard-search-input">í”„ë¡œì íŠ¸ ê²€ìƒ‰</label>
        <input id="dashboard-search-input" type="search" placeholder="ì œëª©, ì–¸ì–´ ë˜ëŠ” IDë¡œ ê²€ìƒ‰" autocomplete="off">
    </section>

    <section class="panel">
        <div class="panel-header">
            <h2>ì§„í–‰ ì¤‘ í”„ë¡œì íŠ¸</h2>
            <span class="panel-meta" id="project-count">0ê°œ</span>
        </div>
        <div id="projects-grid" class="projects-grid">
            <p class="empty-state">í”„ë¡œì íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
    </section>
</div>

<script>
(function () {
    const searchInput = document.getElementById('dashboard-search-input');
    const grid = document.getElementById('projects-grid');
    const countLabel = document.getElementById('project-count');
    const initialProjects = {{ projects | tojson | safe }};

    function escapeHtml(value) {
        return value
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;')
            .replace(/"/g, '&quot;')
            .replace(/'/g, '&#039;');
    }

    function formatDate(value) {
        if (!value) return '';
        const date = new Date(value);
        if (Number.isNaN(date.getTime())) return value;
        return date.toLocaleString('ko-KR', {
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
    }

    function projectLink(project) {
        if (project.project_type === 'translator') {
            return `/translator?id=${encodeURIComponent(project.id)}`;
        }
        return `/shorts?existing=${encodeURIComponent(project.id)}`;
    }

    function renderProjects(items) {
        if (!items.length) {
            grid.innerHTML = '<p class="empty-state">ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            countLabel.textContent = '0ê°œ';
            return;
        }

        const html = items.map((item) => {
            const safeTitle = escapeHtml(item.title || item.id);
            const safeStatus = escapeHtml(item.status);
            const subtitle = item.topic && item.topic !== item.title ? escapeHtml(item.topic) : '';
            const languageLabel = item.language ? escapeHtml(item.language) : '';
            const updatedAt = escapeHtml(formatDate(item.updated_at));

            const dots = Array.from({ length: item.total_steps }, (_, idx) => {
                const active = idx < item.completed_steps ? ' is-active' : '';
                return `<span class="dot${active}"></span>`;
            }).join('');

            // ë””ë²„ê¹…ìš© ë¡œê·¸
            console.log('Project:', item.id, 'Type:', item.project_type, 'Steps:', item.completed_steps);

            // ì˜ìƒí¸ì§‘ ë²„íŠ¼ ì¡°ê±´ í™•ì¸ (ë²ˆì—­ ì™„ë£Œëœ í”„ë¡œì íŠ¸)
            const showVideoEditButton = item.project_type === 'translator' && item.completed_steps >= 2;

            return `
                <a class="project-card" href="${projectLink(item)}" data-title="${safeTitle.toLowerCase()}" data-project-type="${item.project_type}">
                    <div class="thumbnail">
                        <div class="thumbnail-badge">${escapeHtml((languageLabel || 'N/A').toUpperCase())}</div>
                    </div>
                    <div class="project-info">
                        <h3>${safeTitle}</h3>
                        ${subtitle ? `<p class="project-topic">${subtitle}</p>` : ''}
                        <p class="project-status">ìƒíƒœ: ${safeStatus}</p>
                        <div class="progress-dots">${dots}</div>
                        <p class="project-updated">ì—…ë°ì´íŠ¸: ${updatedAt || 'ë¯¸ê¸°ë¡'}</p>
                        <div class="project-actions">
                            ${showVideoEditButton ?
                                `<button class="btn-video-edit" onclick="event.preventDefault(); openVideoEditor('${item.id}')">ì˜ìƒí¸ì§‘</button>` : ''
                            }
                            <button class="btn-clone" onclick="event.preventDefault(); cloneProject('${item.id}')">ë³µì œí•˜ê¸°</button>
                            <button class="btn-delete" onclick="event.preventDefault(); deleteProject('${item.id}')">ì‚­ì œí•˜ê¸°</button>
                        </div>
                    </div>
                </a>
            `;
        }).join('');

        grid.innerHTML = html;
        countLabel.textContent = `${items.length}ê°œ`;
    }

    function fetchProjects(query) {
        const url = query ? `/api/dashboard/projects?query=${encodeURIComponent(query)}` : '/api/dashboard/projects';
        return fetch(url)
            .then((res) => {
                if (!res.ok) {
                    throw new Error('ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
                }
                return res.json();
            });
    }

    function handleSearch() {
        const query = searchInput.value.trim();
        fetchProjects(query)
            .then(renderProjects)
            .catch((err) => {
                console.error(err);
                grid.innerHTML = '<p class="empty-state">í”„ë¡œì íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
                countLabel.textContent = '0ê°œ';
            });
    }

    searchInput.addEventListener('input', () => {
        window.clearTimeout(searchInput._timer);
        searchInput._timer = window.setTimeout(handleSearch, 200);
    });

    renderProjects(initialProjects);

    // ì˜ìƒí¸ì§‘ ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
    window.openVideoEditor = function(projectId) {
        const modal = document.getElementById('video-editor-modal') || createVideoEditorModal();
        loadProjectForEditing(projectId);
        modal.style.display = 'flex';
    };

    function createVideoEditorModal() {
        const modal = document.createElement('div');
        modal.id = 'video-editor-modal';
        modal.className = 'video-editor-modal';
        modal.innerHTML = `
            <div class="modal-content">
                <div class="modal-header">
                    <h3>ì˜ìƒí¸ì§‘</h3>
                    <button class="modal-close" onclick="closeVideoEditor()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="video-selection-section">
                        <h4>ë‹¤ìš´ë¡œë“œëœ ì˜ìƒ ì„ íƒ</h4>
                        <select id="video-file-select" class="form-control">
                            <option value="">ì˜ìƒì„ ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                        <button id="refresh-videos-btn" class="btn-outline">ìƒˆë¡œê³ ì¹¨</button>
                    </div>

                    <div class="template-selection-section">
                        <h4>ë ˆì´ì•„ì›ƒ í…œí”Œë¦¿ ì„ íƒ</h4>
                        <div id="template-options" class="template-grid">
                            <div class="template-option" data-template="classic">
                                <div class="template-preview">1</div>
                                <span>ê¸°ë³¸ í…œí”Œë¦¿</span>
                            </div>
                            <div class="template-option" data-template="banner">
                                <div class="template-preview banner-preview">ğŸ·ï¸</div>
                                <span>í•˜ì´ë¼ì´íŠ¸ ë°°ë„ˆ</span>
                            </div>
                        </div>
                    </div>

                    <div class="subtitle-file-selection-section">
                        <h4>ìë§‰ íŒŒì¼ ì„ íƒ</h4>
                        <select id="subtitle-file-select" class="form-control">
                            <option value="">ìë§‰ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                        <button id="refresh-subtitles-btn" class="btn-outline">ìƒˆë¡œê³ ì¹¨</button>
                    </div>

                    <div class="subtitle-selection-section">
                        <h4>ìë§‰ ìœ í˜• ì„ íƒ</h4>
                        <div id="subtitle-options" class="subtitle-options">
                            <div class="subtitle-option" data-subtitle="translated">
                                <input type="radio" id="subtitle-translated" name="subtitle-type" value="translated" checked>
                                <label for="subtitle-translated">ë²ˆì—­ëœ ìë§‰ (ì¼ë³¸ì–´)</label>
                            </div>
                            <div class="subtitle-option" data-subtitle="original">
                                <input type="radio" id="subtitle-original" name="subtitle-type" value="original">
                                <label for="subtitle-original">ì›ë³¸ ìë§‰ (í•œêµ­ì–´)</label>
                            </div>
                            <div class="subtitle-option" data-subtitle="reverse">
                                <input type="radio" id="subtitle-reverse" name="subtitle-type" value="reverse">
                                <label for="subtitle-reverse">ì—­ë²ˆì—­ ìë§‰ (í•œêµ­ì–´)</label>
                            </div>
                            <div class="subtitle-option" data-subtitle="external">
                                <input type="radio" id="subtitle-external" name="subtitle-type" value="external">
                                <label for="subtitle-external">ì™¸ë¶€ ìë§‰ íŒŒì¼</label>
                            </div>
                        </div>
                    </div>

                    <div class="subtitle-preview-section">
                        <h4>ìë§‰ ë¯¸ë¦¬ë³´ê¸°</h4>
                        <div id="subtitle-preview" class="subtitle-preview">
                            ë²ˆì—­ëœ ìë§‰ì„ ì—¬ê¸°ì„œ ë¯¸ë¦¬ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="process-video-btn" class="btn-primary" disabled>ì˜ìƒ ì²˜ë¦¬ ì‹œì‘</button>
                    <button class="btn-outline" onclick="closeVideoEditor()">ì·¨ì†Œ</button>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        setupVideoEditorEvents();
        return modal;
    }

    function setupVideoEditorEvents() {
        const videoSelect = document.getElementById('video-file-select');
        const refreshBtn = document.getElementById('refresh-videos-btn');
        const subtitleSelect = document.getElementById('subtitle-file-select');
        const refreshSubtitlesBtn = document.getElementById('refresh-subtitles-btn');
        const processBtn = document.getElementById('process-video-btn');
        const templateOptions = document.querySelectorAll('.template-option');
        const subtitleRadios = document.querySelectorAll('input[name="subtitle-type"]');

        refreshBtn.addEventListener('click', loadVideoFiles);
        refreshSubtitlesBtn.addEventListener('click', loadSubtitleFiles);
        videoSelect.addEventListener('change', updateProcessButton);
        subtitleSelect.addEventListener('change', updateSubtitlePreview);
        processBtn.addEventListener('click', processVideo);

        templateOptions.forEach(option => {
            option.addEventListener('click', () => {
                templateOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
            });
        });

        // ìë§‰ íƒ€ì… ë³€ê²½ ì´ë²¤íŠ¸
        subtitleRadios.forEach(radio => {
            radio.addEventListener('change', () => {
                toggleSubtitleFileSelection();
                updateSubtitlePreview();
            });
        });

        // ê¸°ë³¸ í…œí”Œë¦¿ ì„ íƒ
        templateOptions[0].classList.add('selected');
        loadVideoFiles();
        loadSubtitleFiles();
        toggleSubtitleFileSelection();
    }

    function loadVideoFiles() {
        fetch('/api/translator/downloads')
            .then(res => res.json())
            .then(downloads => {
                const videoSelect = document.getElementById('video-file-select');
                videoSelect.innerHTML = '<option value="">ì˜ìƒì„ ì„ íƒí•˜ì„¸ìš”</option>';

                console.log('Downloads response:', downloads);

                // downloadsëŠ” {video_path, subtitle_path, base_name} êµ¬ì¡°ì˜ ë°°ì—´
                downloads.forEach(download => {
                    if (download.video_path) {
                        const option = document.createElement('option');
                        option.value = download.video_path;
                        option.textContent = download.base_name;
                        videoSelect.appendChild(option);
                    }
                });

                console.log(`Loaded ${downloads.length} video files`);
            })
            .catch(err => {
                console.error('ì˜ìƒ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:', err);
            });
    }

    function loadSubtitleFiles() {
        fetch('/api/translator/downloads')
            .then(res => res.json())
            .then(downloads => {
                const subtitleSelect = document.getElementById('subtitle-file-select');
                subtitleSelect.innerHTML = '<option value="">ìë§‰ì„ ì„ íƒí•˜ì„¸ìš”</option>';

                console.log('Subtitle files response:', downloads);

                // ìë§‰ íŒŒì¼ë“¤ (.srt, .vtt, .ass ë“±)
                downloads.forEach(download => {
                    if (download.subtitle_path) {
                        const option = document.createElement('option');
                        option.value = download.subtitle_path;
                        option.textContent = download.base_name;
                        subtitleSelect.appendChild(option);
                    }
                });

                console.log(`Loaded ${downloads.length} subtitle files`);
            })
            .catch(err => {
                console.error('ìë§‰ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:', err);
            });
    }

    function toggleSubtitleFileSelection() {
        const selectedType = document.querySelector('input[name="subtitle-type"]:checked').value;
        const subtitleFileSection = document.querySelector('.subtitle-file-selection-section');

        if (selectedType === 'external') {
            subtitleFileSection.style.display = 'block';
        } else {
            subtitleFileSection.style.display = 'none';
        }
    }

    function loadProjectForEditing(projectId) {
        window.currentProjectId = projectId;
        // í”„ë¡œì íŠ¸ì˜ ë²ˆì—­ëœ ìë§‰ ë¡œë“œ
        fetch(`/api/translator/projects/${projectId}`)
            .then(res => res.json())
            .then(project => {
                console.log('Project loaded:', project);
                window.currentProject = project;
                updateSubtitlePreview();
            })
            .catch(err => {
                console.error('í”„ë¡œì íŠ¸ ë¡œë“œ ì‹¤íŒ¨:', err);
                const subtitlePreview = document.getElementById('subtitle-preview');
                subtitlePreview.textContent = 'ìë§‰ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            });
    }

    function updateSubtitlePreview() {
        const selectedSubtitleType = document.querySelector('input[name="subtitle-type"]:checked').value;
        const subtitlePreview = document.getElementById('subtitle-preview');

        if (selectedSubtitleType === 'external') {
            // ì™¸ë¶€ ìë§‰ íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°
            const subtitleSelect = document.getElementById('subtitle-file-select');
            const selectedFile = subtitleSelect.value;

            if (!selectedFile) {
                subtitlePreview.textContent = 'ìë§‰ íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”.';
                return;
            }

            subtitlePreview.textContent = 'ì™¸ë¶€ ìë§‰ íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° ë¡œë”© ì¤‘...';

            // ì™¸ë¶€ ìë§‰ íŒŒì¼ ë‚´ìš© ë¯¸ë¦¬ë³´ê¸°
            loadExternalSubtitlePreview(selectedFile);
        } else {
            // í”„ë¡œì íŠ¸ ìë§‰ ë¯¸ë¦¬ë³´ê¸°
            const project = window.currentProject;
            if (!project || !project.segments) {
                subtitlePreview.textContent = 'í”„ë¡œì íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
                return;
            }

            console.log(`Found ${project.segments.length} segments`);
            console.log('Selected subtitle type:', selectedSubtitleType);

            const previewText = project.segments
                .slice(0, 5) // ì²˜ìŒ 5ê°œ ì„¸ê·¸ë¨¼íŠ¸ ë³´ê¸°
                .map(seg => {
                    const time = `[${formatTime(seg.start)} --> ${formatTime(seg.end)}]`;
                    let text = '';

                    switch (selectedSubtitleType) {
                        case 'translated':
                            text = seg.translated_text || 'ë²ˆì—­ ì—†ìŒ';
                            break;
                        case 'original':
                            text = seg.source_text || 'ì›ë³¸ ì—†ìŒ';
                            break;
                        case 'reverse':
                            text = seg.reverse_translated_text || 'ì—­ë²ˆì—­ ì—†ìŒ';
                            break;
                        default:
                            text = seg.translated_text || seg.source_text || 'í…ìŠ¤íŠ¸ ì—†ìŒ';
                    }

                    return `${time}\n${text}`;
                })
                .join('\n\n');

            subtitlePreview.textContent = previewText + (project.segments.length > 5 ? '\n\n... ë” ë§ì€ ìë§‰ì´ ìˆìŠµë‹ˆë‹¤' : '');
        }
    }

    function loadExternalSubtitlePreview(subtitlePath) {
        // ì™¸ë¶€ ìë§‰ íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ìœ„í•œ API í˜¸ì¶œ
        fetch(`/api/video-editor/subtitle-preview?path=${encodeURIComponent(subtitlePath)}`)
            .then(res => res.json())
            .then(data => {
                const subtitlePreview = document.getElementById('subtitle-preview');
                if (data.success && data.preview) {
                    subtitlePreview.textContent = data.preview;
                } else {
                    subtitlePreview.textContent = 'ìë§‰ íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                }
            })
            .catch(err => {
                console.error('ìë§‰ íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° ì‹¤íŒ¨:', err);
                const subtitlePreview = document.getElementById('subtitle-preview');
                subtitlePreview.textContent = 'ìë§‰ íŒŒì¼ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            });
    }

    function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    function updateProcessButton() {
        const videoSelect = document.getElementById('video-file-select');
        const processBtn = document.getElementById('process-video-btn');
        processBtn.disabled = !videoSelect.value;
    }

    function processVideo() {
        const videoSelect = document.getElementById('video-file-select');
        const selectedTemplate = document.querySelector('.template-option.selected');
        const selectedSubtitleType = document.querySelector('input[name="subtitle-type"]:checked');

        if (!videoSelect.value || !selectedTemplate || !window.currentProjectId || !selectedSubtitleType) {
            alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
        }

        const processBtn = document.getElementById('process-video-btn');
        const originalText = processBtn.textContent;
        processBtn.textContent = 'ì²˜ë¦¬ ì¤‘...';
        processBtn.disabled = true;

        const payload = {
            project_id: window.currentProjectId,
            video_path: videoSelect.value,
            template: selectedTemplate.dataset.template,
            subtitle_type: selectedSubtitleType.value
        };

        // ì™¸ë¶€ ìë§‰ íŒŒì¼ì´ ì„ íƒëœ ê²½ìš° ì¶”ê°€
        if (selectedSubtitleType.value === 'external') {
            const subtitleSelect = document.getElementById('subtitle-file-select');
            if (!subtitleSelect.value) {
                alert('ì™¸ë¶€ ìë§‰ íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                processBtn.textContent = originalText;
                processBtn.disabled = false;
                return;
            }
            payload.external_subtitle_path = subtitleSelect.value;
        }

        fetch('/api/video-editor/process', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
        })
        .then(res => res.json())
        .then(result => {
            if (result.success) {
                alert('ì˜ìƒ ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                closeVideoEditor();
                // ëŒ€ì‹œë³´ë“œ ìƒˆë¡œê³ ì¹¨
                handleSearch();
            } else {
                alert('ì˜ìƒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
            }
        })
        .catch(err => {
            console.error('ì˜ìƒ ì²˜ë¦¬ ì‹¤íŒ¨:', err);
            alert('ì˜ìƒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        })
        .finally(() => {
            processBtn.textContent = originalText;
            processBtn.disabled = false;
        });
    }

    window.closeVideoEditor = function() {
        const modal = document.getElementById('video-editor-modal');
        if (modal) {
            modal.style.display = 'none';
        }
    };

    // í”„ë¡œì íŠ¸ ë³µì œ í•¨ìˆ˜
    window.cloneProject = function(projectId) {
        if (!confirm('í”„ë¡œì íŠ¸ë¥¼ ë³µì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë³µì œëœ í”„ë¡œì íŠ¸ëŠ” "backup_" ì ‘ë‘ì‚¬ê°€ ë¶™ìŠµë‹ˆë‹¤.')) {
            return;
        }

        // ë³µì œ ì¤‘ì„ì„ í‘œì‹œ
        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = 'ë³µì œ ì¤‘...';
        btn.disabled = true;

        // í”„ë¡œì íŠ¸ ì¹´ë“œì—ì„œ project_type ì •ë³´ë¥¼ ê°€ì ¸ì˜´
        const projectCard = btn.closest('.project-card');
        const projectType = projectCard ? projectCard.dataset.projectType : null;

        // í”„ë¡œì íŠ¸ íƒ€ì…ì— ë”°ë¼ ì ì ˆí•œ API ì—”ë“œí¬ì¸íŠ¸ ì„ íƒ
        let apiUrl;
        if (projectType === 'translator') {
            apiUrl = `/api/translator/projects/${encodeURIComponent(projectId)}/clone`;
        } else {
            apiUrl = `/api/projects/${encodeURIComponent(projectId)}/clone`;
        }

        fetch(apiUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error(`ë³µì œ ì‹¤íŒ¨: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            const clonedId = data.id || data.base_name;
            alert(`í”„ë¡œì íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ë³µì œë˜ì—ˆìŠµë‹ˆë‹¤!\në³µì œëœ í”„ë¡œì íŠ¸ ID: ${clonedId}`);
            // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ë³µì œëœ í”„ë¡œì íŠ¸ í‘œì‹œ
            window.location.reload();
        })
        .catch(error => {
            console.error('ë³µì œ ì˜¤ë¥˜:', error);
            alert('í”„ë¡œì íŠ¸ ë³µì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        })
        .finally(() => {
            btn.textContent = originalText;
            btn.disabled = false;
        });
    };

    window.deleteProject = function(projectId) {
        if (!confirm('ì„ íƒí•œ í”„ë¡œì íŠ¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì‚­ì œ í›„ì—ëŠ” ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
            return;
        }

        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = 'ì‚­ì œ ì¤‘...';
        btn.disabled = true;

        const projectCard = btn.closest('.project-card');
        const projectType = projectCard ? projectCard.dataset.projectType : null;

        const apiUrl = projectType === 'translator'
            ? `/api/translator/projects/${encodeURIComponent(projectId)}`
            : `/api/projects/${encodeURIComponent(projectId)}`;

        fetch(apiUrl, {
            method: 'DELETE'
        })
        .then(response => {
            if (!response.ok && response.status !== 204) {
                throw new Error(`ì‚­ì œ ì‹¤íŒ¨: ${response.status}`);
            }
            alert('í”„ë¡œì íŠ¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.location.reload();
        })
        .catch(error => {
            console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
            alert('í”„ë¡œì íŠ¸ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        })
        .finally(() => {
            btn.textContent = originalText;
            btn.disabled = false;
        });
    };
})();
</script>

<style>
.project-actions {
    margin-top: 8px;
    display: flex;
    gap: 8px;
}

.btn-video-edit {
    background: #4bd4ff;
    color: #101820;
    border: none;
    padding: 4px 12px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-video-edit:hover {
    background: #7ee0ff;
    transform: translateY(-1px);
}

.btn-clone {
    background: #28a745;
    color: white;
    border: none;
    padding: 4px 12px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-clone:hover:not(:disabled) {
    background: #34ce57;
    transform: translateY(-1px);
}

.btn-clone:disabled {
    background: #6c757d;
    cursor: not-allowed;
    transform: none;
}

.btn-delete {
    background: #dc3545;
    color: white;
    border: none;
    padding: 4px 12px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-delete:hover:not(:disabled) {
    background: #f15b6b;
    transform: translateY(-1px);
}

.btn-delete:disabled {
    background: #6c757d;
    cursor: not-allowed;
    transform: none;
}

.video-editor-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

.modal-content {
    background: #1a2332;
    border-radius: 12px;
    width: min(800px, 90vw);
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    border-bottom: 1px solid #2a3441;
}

.modal-header h3 {
    margin: 0;
    color: #f0f4f8;
}

.modal-close {
    background: none;
    border: none;
    font-size: 24px;
    color: #8a9aa9;
    cursor: pointer;
    padding: 4px;
    line-height: 1;
}

.modal-close:hover {
    color: #f0f4f8;
}

.modal-body {
    padding: 24px;
}

.modal-body h4 {
    margin: 0 0 12px;
    color: #4bd4ff;
    font-size: 14px;
    font-weight: 600;
}

.video-selection-section,
.template-selection-section,
.subtitle-preview-section {
    margin-bottom: 24px;
}

.video-selection-section {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.video-selection-section .form-control {
    background: #2a3441;
    border: 1px solid #3a4651;
    border-radius: 6px;
    padding: 8px 12px;
    color: #f0f4f8;
    font-size: 14px;
}

.template-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 12px;
    margin-top: 8px;
}

.template-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 12px;
    border: 2px solid #3a4651;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
}

.template-option:hover {
    border-color: #4bd4ff;
}

.template-option.selected {
    border-color: #4bd4ff;
    background: rgba(75, 212, 255, 0.1);
}

.template-preview {
    width: 60px;
    height: 40px;
    background: #3a4651;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 10px;
    color: #8a9aa9;
    margin-bottom: 8px;
}

.template-preview.banner-preview {
    background: linear-gradient(135deg, #4bd4ff, #7ee0ff);
    color: #101820;
    font-size: 16px;
    font-weight: bold;
}

.template-option span {
    font-size: 12px;
    color: #f0f4f8;
}

.subtitle-file-selection-section,
.subtitle-selection-section,
.template-selection-section,
.subtitle-preview-section {
    margin-bottom: 24px;
}

.subtitle-file-selection-section {
    display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
}

.subtitle-file-selection-section .form-control {
    background: #2a3441;
    border: 1px solid #3a4651;
    border-radius: 6px;
    padding: 8px 12px;
    color: #f0f4f8;
    font-size: 14px;
    margin-bottom: 8px;
}

.subtitle-options {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 8px;
}

.subtitle-option {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    border: 1px solid #3a4651;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
}

.subtitle-option:hover {
    border-color: #4bd4ff;
    background: rgba(75, 212, 255, 0.05);
}

.subtitle-option input[type="radio"] {
    margin: 0;
    accent-color: #4bd4ff;
}

.subtitle-option label {
    margin: 0;
    cursor: pointer;
    font-size: 14px;
    color: #f0f4f8;
    flex: 1;
}

.subtitle-preview {
    background: #2a3441;
    border: 1px solid #3a4651;
    border-radius: 6px;
    padding: 12px;
    min-height: 80px;
    font-size: 14px;
    line-height: 1.4;
    color: #d1dce5;
    white-space: pre-line;
}

.modal-footer {
    padding: 20px 24px;
    border-top: 1px solid #2a3441;
    display: flex;
    gap: 12px;
    justify-content: flex-end;
}

.btn-primary {
    background: #4bd4ff;
    color: #101820;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-primary:hover:not(:disabled) {
    background: #7ee0ff;
    transform: translateY(-1px);
}

.btn-primary:disabled {
    background: #3a4651;
    color: #8a9aa9;
    cursor: not-allowed;
    transform: none;
}

.btn-outline {
    background: transparent;
    color: #4bd4ff;
    border: 1px solid #4bd4ff;
    padding: 10px 20px;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-outline:hover {
    background: #4bd4ff;
    color: #101820;
    transform: translateY(-1px);
}
</style>

</body>
</html>
